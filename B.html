<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<title>생각의 흐름 - 원고지 버전</title>

<!-- 폰트 -->
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Diphylleia&family=Song+Myung&display=swap" rel="stylesheet">

<style>
  body {
    margin: 0;
    font-family: 'Diphylleia', serif;
    background-image: url('paper.jpg');
    background-size: cover;
    background-repeat: no-repeat;
    background-position: center;
    height: 100vh;
    display: flex;
    justify-content: center;
    align-items: center;
    overflow: hidden;
    position: relative;
  }

  /* 상단 카운터 */
  #counterBox {
    position: absolute;
    top: 40px;
    right: 10%;
    text-align: right;
    color: #fff;
    font-size: 22px;
    font-weight: 600;
  }

  #pageNumber {
    margin-top: 5px;
    font-size: 18px;
    opacity: 0.9;
  }

  /* 원고지 */
  #textContainer {
    font-family: 'Song Myung', serif;
    width: 80%;
    height: 70%;
    padding: 30px 35px;
    border-radius: 12px;
    background-color: rgba(255,255,255,0.85);
    color: #222;
    font-size: 20px;
    line-height: 32px;
    overflow-y: auto;
    box-shadow: 0 0 25px rgba(0,0,0,0.25);

    background:
      linear-gradient(to bottom, rgba(150,20,20,0.45) 1px, transparent 1px),
      url('https://www.transparenttextures.com/patterns/paper-fibers.png');
    background-size: 100% 32px, 400px 400px;

    animation: fadeInPage 1s ease forwards;
  }

  @keyframes fadeInPage {
    from { opacity: 0; transform: translateY(20px); }
    to { opacity: 1; transform: translateY(0); }
  }

  /* 페이지 전환 애니메이션 */
  .slideLeft {
    animation: slideLeft 0.6s ease forwards;
  }
  @keyframes slideLeft {
    from { transform: translateX(100%); opacity: 0; }
    to { transform: translateX(0); opacity: 1; }
  }

  .slideRight {
    animation: slideRight 0.6s ease forwards;
  }
  @keyframes slideRight {
    from { transform: translateX(-100%); opacity: 0; }
    to { transform: translateX(0); opacity: 1; }
  }

  /* 화살표 디자인 */
  .arrow {
    position: absolute;
    top: 50%;
    font-size: 50px;
    color: rgba(255,255,255,0.7);
    cursor: pointer;
    user-select: none;
    transform: translateY(-50%);
    transition: 0.2s;
  }
  .arrow:hover {
    color: white;
  }
  #leftArrow { left: 5%; }
  #rightArrow { right: 5%; }

  /* 하단 페이지 상태 */
  #pageStatus {
    position: absolute;
    bottom: 20px;
    font-size: 18px;
    font-family: 'Diphylleia', serif;
    color: white;
    text-align: center;
  }
</style>

</head>
<body>

<!-- 상단 카운터 -->
<div id="counterBox">
  <div id="counter">이야기 완성까지 남은 문장 수 : 50</div>
  <div id="pageNumber">페이지 1</div>
</div>

<!-- 좌우 화살표 -->
<div id="leftArrow" class="arrow">⟵</div>
<div id="rightArrow" class="arrow">⟶</div>

<!-- 원고지 -->
<div id="textContainer"></div>

<!-- 페이지 상태 -->
<div id="pageStatus">1/1</div>

<!-- Firebase -->
<script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-database-compat.js"></script>

<script>
/* Firebase 설정 */
const firebaseConfig = {
  apiKey: "AIzaSyDwMaWKl3EgBMMGKy5llg3OsscHbZOrhYo",
  authDomain: "display1-2e379.firebaseapp.com",
  databaseURL: "https://display1-2e379-default-rtdb.europe-west1.firebasedatabase.app",
  projectId: "display1-2e379",
  storageBucket: "display1-2e379.firebasestorage.appspot.com",
  messagingSenderId: "509686302807",
  appId: "1:509686302807:web:7a73181d53f7ca22363b12"
};
firebase.initializeApp(firebaseConfig);

const db = firebase.database();

/* 상태 변수 */
let remaining = 50;
let currentPage = 1;
let totalPages = 1;

/* 페이지별 내용 저장 */
let pages = {
  1: "" 
};

/* 기본 문장 */
const baseSentence =
  "백설공주는 마녀가 건넨 탐스럽게 빨간 사과를 한입 크게 베어물었고, 마녀는 그런 공주를 보며 의미심장한 웃음을 짓고 있었다.";

/* 요소 */
const container = document.getElementById("textContainer");
const counter = document.getElementById("counter");
const pageNumber = document.getElementById("pageNumber");
const pageStatus = document.getElementById("pageStatus");
const leftArrow = document.getElementById("leftArrow");
const rightArrow = document.getElementById("rightArrow");

/* 초기 페이지 설정 */
pages[1] = baseSentence + " ";
renderPage();

/* 문장 이어붙이기 */
function appendSentence(text) {
  pages[currentPage] += text.trim() + " ";
  renderPage();
}

/* 페이지 렌더링 */
function renderPage(animationClass = "fadeInPage") {
  container.className = "";
  void container.offsetWidth;

  container.classList.add(animationClass);
  container.textContent = pages[currentPage];

  pageNumber.textContent = `페이지 ${currentPage}`;
  pageStatus.textContent = `${currentPage}/${totalPages}`;
}

/* 새로운 페이지 생성 */
function createNewPage() {
  currentPage++;
  totalPages++;
  pages[currentPage] = baseSentence + " ";
  remaining = 50;
  counter.textContent = "이야기 완성까지 남은 문장 수 : 50";
  renderPage("slideLeft");
}

/* Firebase 새로운 문장 올 때 */
db.ref("messages").on("child_added", snapshot => {
  const data = snapshot.val();
  if (!data || !data.text) return;

  appendSentence(data.text);

  remaining--;
  counter.textContent = `이야기 완성까지 남은 문장 수 : ${remaining}`;

  if (remaining <= 0) createNewPage();
});

/* 왼쪽 화살표 클릭 */
leftArrow.addEventListener("click", () => {
  if (currentPage === 1) {
    alert("이야기의 첫 페이지입니다");
    return;
  }
  currentPage--;
  renderPage("slideRight");
});

/* 오른쪽 화살표 클릭 */
rightArrow.addEventListener("click", () => {
  if (currentPage === totalPages) {
    alert("아직 이야기가 완성되지 않았어요!");
    return;
  }
  currentPage++;
  renderPage("slideLeft");
});
</script>

</body>
</html>
