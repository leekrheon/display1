<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<title>ìƒê°ì˜ íë¦„ - ì›ê³ ì§€ ë²„ì „</title>

<!-- í°íŠ¸ -->
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Diphylleia&family=Song+Myung&display=swap" rel="stylesheet">

<style>
  body {
    margin: 0;
    font-family: 'Diphylleia', serif;
    background-image: url('paper.jpg');
    background-size: cover;
    background-repeat: no-repeat;
    background-position: center;
    height: 100vh;
    display: flex;
    justify-content: center;
    align-items: center;
    overflow: hidden;
    position: relative;
  }

  /* ìƒë‹¨ ì¹´ìš´í„° */
  #counterBox {
    position: absolute;
    top: 40px;
    right: 10%;
    color: #fff;
    font-size: 22px;
    font-weight: 600;
    text-align: right;
  }

  /* ì›ê³ ì§€ */
  #textContainer {
    font-family: 'Song Myung', serif;
    width: 80%;
    height: 70%;
    padding: 30px 35px 30px 35px;

    border-radius: 12px;

    /* ì¤„ ê°„ê²© 42px + ì¤„ì„ ì•½ê°„ ìœ„ë¡œ */
    background:
      linear-gradient(to bottom, rgba(180,60,60,0.40) 1px, transparent 1px),
      url('https://www.transparenttextures.com/patterns/paper-fibers.png');

    background-size: 100% 42px, 400px 400px;
    background-position-y: -6px;  /* ğŸ”¥ ì¤„ì„ ìœ„ë¡œ ì˜¬ë¦¼ */

    background-attachment: local;

    /* ğŸ”¥ ì›ê³ ì§€ ë°°ê²½ì„ ë” íˆ¬ëª…í•˜ê²Œ (ì˜›ë‚  ë²„ì „ì²˜ëŸ¼) */
    background-color: rgba(255,255,255,0.7);

    font-size: 23px;
    line-height: 42px;

    overflow-y: auto;
    box-shadow: 0 0 25px rgba(0,0,0,0.25);
  }

  /* í˜ì´ì§€ ì´ë™ ì• ë‹ˆë©”ì´ì…˜ */
  .slideLeft { animation: slideLeft 0.5s ease forwards; }
  @keyframes slideLeft {
    from { transform: translateX(80%); opacity: 0; }
    to   { transform: translateX(0); opacity: 1; }
  }

  .slideRight { animation: slideRight 0.5s ease forwards; }
  @keyframes slideRight {
    from { transform: translateX(-80%); opacity: 0; }
    to   { transform: translateX(0); opacity: 1; }
  }

  /* í™”ì‚´í‘œ ë²„íŠ¼ */
  .arrowBtn {
    position: absolute;
    top: 50%;
    transform: translateY(-50%);
    width: 40px;
    height: 40px;
    background-color: rgba(255,255,255,0.95);
    border-radius: 50%;
    display: flex;
    justify-content: center;
    align-items: center;

    color: #333;
    font-size: 18px;
    cursor: pointer;

    box-shadow: 0 3px 10px rgba(0,0,0,0.25);
    transition: 0.2s;
  }

  #leftArrow { left: 2%; }
  #rightArrow { right: 2%; }
  .arrowBtn:hover { background-color: white; }

  /* í˜ì´ì§€ ë²ˆí˜¸ */
  #pageStatus {
    position: absolute;
    bottom: 20px;
    font-size: 20px;
    color: white;
  }
</style>
</head>

<body>

<!-- ğŸ”Š MP3 ìë™ ì¬ìƒ -->
<audio id="bgm" src="bgm.mp3" autoplay loop></audio>

<div id="counterBox">
  <div id="counter">ì´ì•¼ê¸° ì™„ì„±ê¹Œì§€ ë‚¨ì€ ë¬¸ì¥ ìˆ˜ : 50</div>
</div>

<div id="leftArrow" class="arrowBtn">âŸµ</div>
<div id="rightArrow" class="arrowBtn">âŸ¶</div>

<div id="textContainer"></div>

<div id="pageStatus">1/1</div>

<!-- Firebase -->
<script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-database-compat.js"></script>

<script>
/* Firebase config */
const firebaseConfig = {
  apiKey: "AIzaSyDwMaWKl3EgBMMGKy5llg3OsscHbZOrhYo",
  authDomain: "display1-2e379.firebaseapp.com",
  databaseURL: "https://display1-2e379-default-rtdb.europe-west1.firebasedatabase.app",
  projectId: "display1-2e379",
  storageBucket: "display1-2e379.firebasestorage.appspot.com",
  messagingSenderId: "509686302807",
  appId: "1:509686302807:web:7a73181d53f7ca22363b12"
};
firebase.initializeApp(firebaseConfig);

/* ë³€ìˆ˜ */
let remaining = 50;
let currentPage = 1;
let totalPages = 1;
let pages = { 1: "" };

/* ì²« ë¬¸ì¥ (ê²€ì •ìƒ‰ ê³ ì •) */
const baseSentence =
"ë°±ì„¤ê³µì£¼ëŠ” ë§ˆë…€ê°€ ê±´ë„¨ íƒìŠ¤ëŸ½ê²Œ ë¹¨ê°„ ì‚¬ê³¼ë¥¼ í•œì… í¬ê²Œ ë² ì–´ë¬¼ì—ˆê³ , ë§ˆë…€ëŠ” ê·¸ëŸ° ê³µì£¼ë¥¼ ë³´ë©° ì˜ë¯¸ì‹¬ì¥í•œ ì›ƒìŒì„ ì§“ê³  ìˆì—ˆë‹¤.";

/* DOM */
const container = document.getElementById("textContainer");
const counter = document.getElementById("counter");
const pageStatus = document.getElementById("pageStatus");

/* ğŸ¨ ë°ì€ ì‰í¬ìƒ‰ 12ì¢… */
const inkColors = [
  "#4A4A4A", "#A04A4A", "#B24C7A", "#2F5FA3",
  "#3C8090", "#2F7A67", "#4A6F8F", "#7A3C98",
  "#A5633F", "#2F8A83", "#7A4B35", "#3C4F7F"
];

let lastColor = null;

/* ëœë¤ ì‰í¬ (ì§ì „ê³¼ ê²¹ì¹˜ì§€ ì•Šê²Œ) */
function getInkColor() {
  let c = inkColors[Math.floor(Math.random() * inkColors.length)];
  while (c === lastColor) {
    c = inkColors[Math.floor(Math.random() * inkColors.length)];
  }
  lastColor = c;
  return c;
}

/* ë¬¸ì¥ ìŠ¤íƒ€ì¼ */
function styledSentence(text) {
  return `<span style="color:${getInkColor()}; font-weight:600;">${text.trim()} </span>`;
}

/* ğŸ”¥ ì²« í˜ì´ì§€ëŠ” ê²€ì •ìƒ‰ */
pages[1] =
  `<span style="color:#000; font-weight:600;">${baseSentence}</span> `;

renderPage();

/* ë¬¸ì¥ ì¶”ê°€ */
function appendSentence(text) {
  pages[currentPage] += styledSentence(text);
  renderPage();
}

/* ë Œë”ë§ */
function renderPage(animation = "") {
  container.className = "";
  void container.offsetWidth;

  if (animation) container.classList.add(animation);

  container.innerHTML = pages[currentPage];
  pageStatus.textContent = `${currentPage}/${totalPages}`;
}

/* ìƒˆ í˜ì´ì§€ */
function createNewPage() {
  currentPage++;
  totalPages++;

  pages[currentPage] =
    `<span style="color:#000; font-weight:600;">${baseSentence}</span> `;

  remaining = 50;
  counter.textContent = "ì´ì•¼ê¸° ì™„ì„±ê¹Œì§€ ë‚¨ì€ ë¬¸ì¥ ìˆ˜ : 50";

  renderPage("slideLeft");
}

/* Firebase ìˆ˜ì‹  */
firebase.database().ref("messages").on("child_added", snapshot => {
  const data = snapshot.val();
  if (!data || !data.text) return;

  appendSentence(data.text);
  remaining--;
  counter.textContent = `ì´ì•¼ê¸° ì™„ì„±ê¹Œì§€ ë‚¨ì€ ë¬¸ì¥ ìˆ˜ : ${remaining}`;

  if (remaining <= 0) createNewPage();
});

/* í˜ì´ì§€ ì´ë™ */
leftArrow.addEventListener("click", () => {
  if (currentPage === 1) return alert("ì²« í˜ì´ì§€ì…ë‹ˆë‹¤!");
  currentPage--;
  renderPage("slideRight");
});

rightArrow.addEventListener("click", () => {
  if (currentPage === totalPages) return alert("ì•„ì§ ë‹¤ìŒ í˜ì´ì§€ê°€ ì—†ìŠµë‹ˆë‹¤!");
  currentPage++;
  renderPage("slideLeft");
});
</script>

</body>
</html>
